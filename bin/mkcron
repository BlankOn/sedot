#!/usr/bin/env bash

. `dirname $0`/../etc/config.sh

NODE=$1

if [ "$NODE" == "" ]; then
	NODE=`hostname -f`
fi

NODEDIR=$BASE/nodes/$NODE
PKGS=$NODEDIR/pkgs
CRON=$BASE/data/cron/$NODE.cron

mkdir -p $NODEDIR
[ -f $PKGS ] || touch $PKGS

exec 3>&1
exec 1>$CRON

echo "# Do NOT edit this file."
echo "# This file is generated automatically by mkcron of sedot."
echo "# Generated at `date`"
echo
echo "# Node: $NODE"
echo 
echo "PATH=$PATH:$BASE/bin"
echo

cat $PKGS | while read pkg
do
	cron=`cat $BASE/pkgs/$pkg/cron`
	echo "# $pkg"
	echo "$cron sedot $pkg > /dev/null 2>&1"
	echo
done


exec 1>&3

