#!/usr/bin/env bash

set -e

. `dirname $0`/../etc/config.sh

NODE=$1

if [ "$NODE" == "" ]; then
	NODE=`hostname -f`
fi

NODEDIR=$BASE/nodes/$NODE
CRON=$BASE/data/cron/$NODE.cron

# Create crontab file

[ -f $CRON ] && cp $CRON $CRON.old
$BASE/bin/make-crontab $NODE

# Update crontab

crontab -l > $CRON.old.active
cat $CRON.old.active | sed '/BEGIN SEDOT CRONTAB LIST/,/END SEDOT CRONTAB LIST/d' > $CRON.active
cat $CRON >> $CRON.active
crontab - < $CRON.active

echo "Crontab updated."

