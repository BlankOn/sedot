#!/usr/bin/env bash

. `dirname $0`/../etc/config.sh
. $BASE/lib/common.sh

NODE=$1

if [ "$NODE" == "" ]; then
	NODE=`hostname -f`
fi

DISKS=$BASE/nodes/$NODE/disks
OUTDIR=$BASE/data/disk-usage/$NODE
OUT=$OUTDIR/`date '+%Y%m'`.txt

[ -f $DISKS ] || exit 1

mkdir -p $OUTDIR
TS=`date '+%Y%m%d.%H%M%S'`

cat $DISKS | while read disk
do
	echo -n "$TS " >> $OUT
	df -P | awk "\$1 == \"$disk\" { print \$1 \" \" \$3 \" \" \$4 }" >> $OUT
done

